
# 네트워크 계층 

### ARP (Address Resolution Protocol)
- MAC주소와 IP주소를 함께 사용하지만 기본적으로 IP주소를 사용한다. 
- 이 과정에서 상대 호스트의 IP주소는 알지만 MAC 주소를 알지 못하는 상황이 있을 수 있는데 ARP 프로토콜을 사용한다. 
- ARP 프로토콜은 IP주소를 통해 MAC주소를 알아내는 프로토콜이다.
- A와 B가 동일한 네트워크에 속한 상태일 때 A가 B에게 패킷을 보내고 싶다고 가정할 때 A는 B의 IP주소를 알고 있자만 MAC 주소를 모르는 상황이다. 
- 네트워크에서 사용되는 주소는 IP주소이지만 패킷을 올바르게 전송하기 위해서 MAC주소를 알아야한다. 여기에서 ARP가 사용된다. 

#### ARP 요청 
- A는 네트워크 내의 모든 호스트에게 브로드캐스트 메시지를 보낸다. 

#### ARP 응답 
- 네트워크 내의 모든 호스트가 ARP 요청 메시지를 수신하지만 B를 제외한 나머지 호스트는 자신의 IP 메시지가 아니므로 무시한다. 
- B는 자신의 MAC 주소를 담은 메시지를 A에게 전송하는데 이 유니캐스트 메시지는 ARP 응답이라는 ARP 패킷이다. 
- B의 MAC주소가 포함된 메시지를 수신한 A는 B의 MAC주소를 알게된다. 
  
#### ARP 테이블 갱신 
- ARP를 활용할 수 있는 모든 호스트는 ARP 테이블이라는 정보를 유지한다.
- ARP 테이블은 IP주소와 그에 맞는 MAC주소 테이블을 대응하는 표이다. 
- ARP 요청 - 응답 단계를 통해서 호스트 B의 IP주소와 MAC 주소의 연관 관계를 ARP 테이블에 추가한다. 
- ARP 테이블은 일정 시간이 지나면 삭제되고 임의로 삭제가 가능하다. 
- 호스트 A와 호스트 B 가 동일한 네트워크에 있지 않을 경우에는 호스트 A가 라우터 A의 MAC 주소를 모르면 ARP 요청 - 응답 과정을 통해 라우터 A의 MAC주소를 얻어와서 이를 향해 패킷을 전송한다. 
- 라우터 A 는 패킷을 라우터 B로 전달하고 라우터 A가 라우터 B의 MAC 주소를 모르면 ARP 요청 - 응답 과정을 거쳐서 라우터 B의 MAC 주소를 알아낸다. 
- 이 과정을 반복해서 다른 네트워크에 있는 B에게 메시지를 송신한다. 
  
  
### IP 단편화 
- IP 단편화는 되도록 하지 않는 것이 좋다. 데이터가 여러 패킷으로 쪼개지면 자연스럽게 전송해야  할 패킷의 헤더들이 증가하고 트래픽 증가와 대역폭 낭비로 이어진다. 
- IP 단편화를 피하기 위해서는 IP 패킷을 주고받는 호스트의 처리 가능한 MTU 크기를 고려해야 한다. 
- 호스트 A, 호스트 B가 처리할 수 있는 MTU 크기가 아무리 크다고 하더라도 라우터가 해당 MTU크기를 지원하지 않으면 IP단편화가 불가피하다. 
- IP 단편화 없이 주고 받을 수있는 최대 크기 만큼 전송을 할 필요가 잇는데 이 크기를 경로 MTU 라고 한다. 

--- 
> 강민철, 『혼자 공부하는 네트워크』, 한빛미디어 (2018)    
