# 네트워크 계층 

## 인터넷 프로토콜 (Internet Protocol)
- 네트워크 계층의 가장 핵심적인 프로토콜로 IP에는 IPv4, IPv6 두 가지 버전이 있다. 

#### IP 주소 형태 
- IPv4 주소는 4바이트로 표현할 수있고 숫자당 0~255 안에 있는 네 개의 10진수로 표기된다. 
- 각 10진수는 점으로 구분되며 점으로 구분된 8비트를 옥텟(OCTET)이라고 한다. 


### IP의 기능 
- IP의 기능은 다양하지만 대표적으로 IP주소 지정과 IP 단편화가 있다.   
| The Internet protocol implements two basic functions : addressing and framentation 

####  IP 주소 지정 
- IP 주소 지정은 IP주소를 바탕으로 송수신 대상을 지정하는 것을 의미한다. 
- IP 단편화는 전송하고자 하는 패킷의 크기가 MTU(Maximum Transmission Unit)라는 최대 전송 단위 보다 클 경우 이를 MTU 크기 이하의 복수의 패킷으로 나누는 것을 의미한다. 


#### MTU(Maximum Transmission Unit)
- 한 번에 전송 가능한 IP 패킷을 최대 크기를 의미한다. IP패킷의 헤더도 MTC 크기에 포함된다. 
- 일반적인 MTU 크기는 1500 바이트 mtc 크기 이라호 나누어진 패킷은 수신지에 도착하면 다시 재조합돈다. 

### IPv4 
- IPv4 패킷은 프레임의 **페이로드로 데이터 필드에 명시**된다.   
- 식별자 플래그 단편화 오프셋, TTL, 프로토콜 송/수신지 IP 주소 주소가 핵심이 되는 부분이다. 
  
#### 식별자 (Identifier)
- 식별자는 패킷에 할당된 번호이다. 메시지 전송과정에서 IPv4 패킷이 여러 조각으로 쪼개져서 전송되면 수신지에서 이들을 재조합해야 한다. 
- 잘게 쪼개져서 도착한 IPv4 패킷들이 어떤 메시지에서 쪼개졌는지 인식하기 위해 식별자를 사용한다. 

#### 플래그(Flag)
- 플래그는 총 3개의 비트로 구성된 필드이다. 
- 첫번째 필드는 항상 0으로 예약된 필드로 현재 사용하지 않는다. 
    #### DF(Don't Fragment) 
    - 하나는 DF로 IP 단편화를 수행하지 말라는 표시이다. 이 필드가 1로 설정되어 있다면 IP 단편화를 수행하지 않고 0으로 설정되면 IP단편화가 가능하다. 
    - 1로 설정되어 있다고 해도 패킷의 크기가 너무 크면 이는 폐기 된다. 

    #### MF(More Fragment) 
    - 하나의 비트는 MF로 단편화 된 패킷이 더 있는지 나타내는 비트이다. 
    - 0이라면 마지막 패킷이고 1이라면 쪼개진 패킷이 더 있다는 것을 의미한다. 

#### 단편한 오프셋(Fragment Offset)
- 패킷이 단편화 되기전에 초기 데이터에서 몇 번째로 떨어진 패킷인지를 나타낸다. 
- 단편화된 패킷들은 수신지에서 순서대로 도착하지 않을 수 있기 때문에 수신지가 패킷들을 순서대로 재조합하기 위해서는 단편화된 패킷이 초기 데이터에서 몇 번째 데이터에 해당하는지 알아야 하는데 이를 판단하기 위해서 단편화 오프셋이 사용된다. 


#### TTL (Time to Live)
- 패킷의 수명을 나타내는데 멀리 떨어진 호스트끼리 통신할 때 여러 라우터를 거쳐서 가므로 패캣이 하나의 라우터를 거칠때 마다 TTL이 1씩 감소 하며 TTL값이 0으로 떨어지면 폐기된다. 
- 패킷이 호스트 또는 라우터에 한 번 전달 되는 것을 Hop이라고 한다. 

#### Protocol 
- IP 패킷의 프로토콜은 상위 계층의 프로토콜이 무엇인지를 나타내는 필드를 의미한다. 
- 전송 계층의 대표적인 프로토콜로 TCP는 6번을 UDP는 17 번을 의미한다. 
  
### IPv6 
- 이론적으로 할당 가능한 IPv4주소는 43억개지만 IPv4의 주소 총량은 쉽게 고갈이 가능해서 등장한 것이 IPv6이다. 
- 16 바이트로 주소를 표현가능하고 :으로 구분된 8개 그룹의 16진수로 표기 된다. 

#### next header 
- next header 필드는 상위 계층의 프로토콜을 가리키거나 확장 헤더를 가리킨다. 
- IPv6위 헤더는 기본 헤더이다. 기본 헤더에는 페이로드 길이, 다음헤더, 홉제한, 송신지 IP 주소, 수신지 IP 주소가 있는데 이와 더불어 확장 헤더라는 추가 헤더를 가질 수 있다. 
  
#### hop limit 
- 홉제한 필드는 IPv4 패킷의 TTL 필드와 비슷하게 패킷으 수명을 나타내는 필드이다. 

--- 
> 강민철, 『혼자 공부하는 네트워크』, 한빛미디어 (2018)    
