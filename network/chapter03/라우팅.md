# 네트워크 계층 
 
## 라우터 
- 라우터는 네트워크 계층의 핵심 기능을 담당한다. 
- L3 스위치라 부르는 네트워크 계층의 장치가 별도로 존재하기는 하지만 오늘날 라우터 L3 스위치는 매무 유사하다. 
- 멀리 떨어진 호스트 간의 통신 과정에서 패킷은 서로에게 도달하기 까지 여러 라우터를 거쳐서 다양한 경로로 이동 가능하다. 
- 라우팅 도중 패킷이 호스트와 라우터 간에 혹은 라우터와 라우터 간에 이동하는 하나의 과정을 **홉(hop)**라고 한다. 

### 라우팅 테이블 (Routing table)
- 라우팅의 핵심은 라우터가 저장하고 관리하는 라우팅 테이블 이다. 
- 라우팅 테이블은 특정 수신지 까지 도달하기 위한 정보를 명시한 일종의 표와 같은 정보이다. 
- 라우팅 테이블에 포함된 정보는 라우팅 방식에 따라 호스트 환경에 따라 달라질 수 있다. 
- 수신지 IP, 서브넷 마스크 : 최종적으로 패킷을 전달할 대상을 의미한다. 
- 다음 홉 : 최종 수신지까지 가기 위해 다음으로 거쳐야 할 호스트 IP 주소나 인터페이스를 의미하며 게이트웨이라고 명시되기도 한다. 
- 네트워크 인터페이스 : 패킷을 내보낼 통로로 NIC 이름이 명시되거나 인터페이스에 대응하는 IP 주소가 명시되기도한다. 
- 메트릭 : 해당 경로로 이동하는데 드는 비용을 의미한다. 
- 라우팅 테이블에 없는 경로로 페킷을 전송해야 할 경우가 있는데 이 경우 기본적으로 내보낼 경로를 설정하여 해당 경로에 패킷을 내보낼 수가 있으며 이 기본 경로를 디폴트 라우트라고 한다. 

### 정적 라우팅과 동적 라우팅 
#### 정적 라우팅 
- 사용자가 수동으로 직접 채워 넣은 라우팅 테이블의 항목을 토대로 라우팅 되는 방식이다. 

#### 동적 라우팅 
- 네트워크가 규모가 커지고 관리해야 할 라우터가 많아지면 정적 라우팅만으로는 어렵다. 
- 동적 라우팅은 자동으로 라우터 테이블 항목을 만들고 이를 이용하여 라우팅하는 방식을 의미한다. 
- 모든 라우터는 수신지까지 도달하기 위한 최적의 경로를 찾아 라우팅 테이블에 추가하려고 하는데 이를 위해 라우터들 끼리 서로 자신의 정보를 교환한다. 
- 이 과정에서 사용되는 프로토콜이 바로 동적 라우팅 프로토콜이다. 

### AS(Autonomous System) 
- 라우팅 정책으로 운용되는 라우터들의 집단 네트워크인 AS가 있다. 
- 한 회사나 단체에서 관리하는 라우터 집단을 AS라고 생각하면 좋다. 
- AS 마다 인터넷상 고유한 AS 번호 (ASN: Autonomous System Number)가 할당 된다. 
- 한 AS 마다 다수의 라우터가 있고 라우터 들은 AS 내부 / 외부 와 통신이 가능하다. 
- AS 외부와 통신할 경우 AS 경계에서 AS 내외로 통신을 주고 받을 수 있는 AS 경계 라우터(ASBR: Autonomous System Boundary Router)라는 특별한 라우터를 이용한다. 
  
### 라우팅 프로토콜 
- 라우팅 프로토콜은 라우터 끼리 자신들의 정보를 교환하여 패킷이 이동할 최적의 경로를 찾기 위한 프로토콜이다. 
- 라우팅 프로토콜은 AS 내부, 외부 수행 여부에 따라 IGP, EGP로 나눌 수 있다. 
#### IGP: RIP, OSPF 
- IGP(Interior Gateway Protocol)로는 RIP와 OSPF가 있다. 
- 이 프로토콜은 최적의 경로를 설정하는 과정에서 거리 벡터가 사용되느냐, 링크 상태가 사용되느냐로 구분할 수 있다.

#### RIP(Routing Information Protocol) 
- 거리 벡터 기반 라우팅 프로토콜로 거리를 기반으로 최적의 경로를 찾는 라우팅 프로토콜을 의미한다. 
- 거리는 패킷이 경유한 라우터의 수 즉 홉의 수를 의미한다. 
- RIP는 인접한 라우터끼리 정보 정보를 주기적으로 교한하며 라우팅 테이블을 갱신해 특정 수신지까지 도달하기 까지의 홉의 수를 알 수 있다. 
- 특정 수신지 까지 도달하기 위해 홉스가 가장 적은 경로를 최적의 경로로 판단한다. 
    
#### OSPF(Open Shortest Path First)
- OSPF는 현재 네트워크의 상태를 그래프 형태로 링크상태 데이터베이스(LSDB: Link State Database)에 저장한다. 
- 링크 상태 데이터베이스에는 라우터들의 연결관계, 연결 빙요, 현재 네트워크 상태를 그래프로 표현하기 위한 데이터가 저장되어 있는데 이 데이터베이스를 기반으로 현재 네트워크 구성을 마치 지도처럼 그린 뒤 최적의 경로를 선택한다. 
- 라우터 간의 주기적으로 정보를 교환하며 라우팅 테이블을 갱신하는 RIP와 다르게 OSPT는 네트워크 구성이 변경되었을 때 라이팅 테이블이 갱신된다. 
- 네트워크 구성이 변경될 때마다 테이블이 갱신되면 네트워크 규모가 매우 커질 경우 링크 상태 데이터베이스에 모든 것을 저장하기 어렵다. 
- OSPF는 AS를 에어리어라는 단위로 나누고 에어리어 내에서만 링크 상태를 공유한다. 
- 에어리어 내에서만 링크 상태를 공유하고 에어리어 경계에 있는 ABR(Area Border Router)라우터가 에어리어간 연결을 담당한다. 

#### EGP : BGP
- 대표적인 EGP로는 BGP가 있다. AS 간의 통신에서 사용되는 대표적인 프로토콜로 AS 간의 통신이 가능한 프로토콜이다. 
- AS간의 통신을 위한 BGP는 eBGP , AS 내의 통신을 위한 BGP는 iBGP라고 한다. 
- AS 간에 정보를 주고 받기 위해서는 AS 내에서 eBGP를 사용하는 라우터가 하나 이상 있어야 하고 또 다른 AS의 BGP 라우터와 연결되어 있어야 한다. 
- 이 연결은 BGP 라우터 간에 BGP 메시지를 주고 받음으로써 이루어지는데 BGP 메시지를 주고 받을 수 있도록 연결된 라우터를 피어라고 정의한다. 
- 이렇게 피어 관계가 되도록 연결하는 과정을 피어링이라고 한다. 
- BGP는 RIP와 OSPF에 비해서 최적의 경로를 결정하는 과정이 복잡하고 일정하지 않은 경우가 많은데 경로 결정 과정에서 속성과 정책이 고려된다. 

#### AS-PATH 
- AS-PATH 속성은 메시지가 수신지에 이르는 과정에서 통과하는 AS들의 목록을 의미한다. 
- 메시지가 AS를 거칠 때 마다 AS-PATH 에는 거쳐간 AS가 추가된다. 
- BGP는 AS간 라우팅을 할때 거치게 될 라우터가 아닌 AS의 수를 고려한다. 
- BGP는 RIP처럼 단순히 수신지에 이르는 거리가 아닌 메시지가 어디를 거쳐 어디로 이동하는지는 나타내는 경로를 고횬한다. 

#### NEXT-HOP 속성 
- NEXT-HOP 속성은 다음 홉, 다음으로 거칠 라우터의 IP 주소를 나타낸다. 

#### LOCAL-PREF 속성 
- LOCAL-PREF는 지역 선호도 Local Preference의 약자이다. 
- AS의 외부 경로에 있어 AS 내부에서 어떤 경로를 선호할지에 대한 척도를 나타낸다. 
- 경로 선택시 LOCAL-PREF값은 일반적은 AS-PATH, NEXT-HOP 속성보다 우선시 되며 LOCAL-PREF 값이 클수록 우선으로 선택된다. 

### 인터넷 프로토콜 보안 (IPSec: Internet Protocol Security)
- IP 패킷이 목적지에 도착할 때 까지 여러 라우터를 거치게 된다. 
- 누군가 패킷에 가짜 발신 IP 주소를 써서 해당 패킷이 다른 호스트가 보내는 것 처럼 만들 수 있는데 이를 <u>IP spoofing</u> 라고 한다. 
- IP spoofing을 해결하는 방법이 인터넷 프로토콜 보안(IPSec:Internet Protocol Security) 기술이다. 
- IPSec는 데이터 패킷은 무결성, 진보성, 신뢰성을 보장하는 다양한 방식을 통틀어 이루는 용어이다. 
- 서비스 거부 Dos(Denial-Of-Service) 공격으로 부터 데이터를 보호할 수 있다.  
- Dos 공격자는 발신 주소를 다르게 해서 엄청나게 많은 패킷은 한 IP로 동시에 보내면 과부하로 인해 응답할 수 없고 노드를 먹통으로 만든다. 
- IPSec는 좋은 방법이지만 설정이 복잡하고 번거로워서 널리 쓰이지 않는다. 

--- 
> 강민철, 『혼자 공부하는 네트워크』, 한빛미디어 (2018)    
> 아티클 19, 『읽자마자 IT 전문가가 되는 네트워크 교과서』, 보누스(2023)
